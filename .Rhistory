#   select(placekey, popularity_by_hour, date_range_start) %>%
#   mutate(date_range_start = as_date(date_range_start),
#          month =  month(date_range_start)) %>%
#   dplyr::select(-date_range_start) %>%
#   mutate(popularity_by_hour = future_map(popularity_by_hour, function(x){
#     unlist(x) %>%
#       as_tibble() %>%
#       rowid_to_column(var = "hour") %>%
#       rename(visit = value)
#   }))%>%
#   unnest(popularity_by_hour)
#
# st_write(visitWeekday,"data/output/visitHour.GeoJSON")
visitHour <- st_read("data/output/visitHour.GeoJSON")
# unnest the origin-destination data
# originCount <-
#   PPRmoves %>%
#   select(placekey, visitor_home_cbgs, date_range_start) %>%
#   mutate(date_range_start = as_date(date_range_start),
#          month =  month(date_range_start)) %>%
#   dplyr::select(-date_range_start) %>%
#   mutate(visitor_home_cbgs = future_map(visitor_home_cbgs, function(x){
#     jsonlite::fromJSON(x) %>%
#       as_tibble()
#   })) %>%
#   unnest(visitor_home_cbgs)
#
# originCount <- originCount %>%
#   dplyr::select(placekey, month, starts_with("4")) %>%
#   pivot_longer(cols = starts_with("4"), names_to = "origin", values_to = "visits", values_drop_na = TRUE)
#st_write(originCount,"data/output/originCount.GeoJSON")
originCount <- st_read("data/output/originCount.GeoJSON")
# The following codes is different from the above. Because I try to gather the data inside the tibble instead of the old way. This new way can greatly increase the efficiency.
# unnest the departure - destination data
# departCount <-
#   PPRmoves %>%
#   select(placekey, visitor_daytime_cbgs, date_range_start) %>%
#   mutate(date_range_start = as_date(date_range_start),
#          month =  month(date_range_start)) %>%
#   dplyr::select(-date_range_start) %>%
#   mutate(visitor_daytime_cbgs = future_map(visitor_daytime_cbgs, function(x){
#     jsonlite::fromJSON(x) %>%
#       as_tibble() %>%
#       dplyr::select(starts_with("4")) %>%
#       gather()
#   }))%>%
#   unnest(visitor_daytime_cbgs) %>%
#   rename(departure =key ,visitors= value)
#st_write(departCount,"data/output/departCount.GeoJSON")
departCount <- st_read("data/output/departCount.GeoJSON")
# unnest the bucketed_dwell_times data
# dwellTime <-
#   PPRmoves %>%
#   select(placekey, bucketed_dwell_times, date_range_start) %>%
#   mutate(date_range_start = as_date(date_range_start),
#          month =  month(date_range_start)) %>%
#   dplyr::select(-date_range_start) %>%
#   mutate(bucketed_dwell_times = future_map(bucketed_dwell_times, function(x){
#     jsonlite::fromJSON(x) %>%
#       as_tibble() %>%
#       gather()
#   }))%>%
#   unnest(bucketed_dwell_times) %>%
#   rename(dwellTimes =key ,visitors= value)
#st_write(dwellTime,"data/output/dwellTime.GeoJSON")
dwellTime <- st_read("data/output/dwellTime.GeoJSON")
# unnest the related_same_day_brand
# relatedBrand <-
#   PPRmoves %>%
#   select(placekey, related_same_day_brand, date_range_start) %>%
#   mutate(date_range_start = as_date(date_range_start),
#          month =  month(date_range_start)) %>%
#   dplyr::select(-date_range_start) %>%
#   mutate(related_same_day_brand = future_map(related_same_day_brand, function(x){
#     jsonlite::fromJSON(x) %>%
#       as_tibble() %>%
#       gather()
#   }))
#
# relatedBrand <- relatedBrand %>%
#   unnest(related_same_day_brand) %>%
#   rename(relatedBrand =key ,visitors= value)
#st_write(relatedBrand,"data/output/relatedBrand.GeoJSON")
relatedBrand <- st_read("data/output/relatedBrand.GeoJSON")
# unnest the popularity_by_day data
# visitWeekday <-
#   PPRmoves %>%
#   select(placekey, popularity_by_day, date_range_start) %>%
#   mutate(date_range_start = as_date(date_range_start),
#          month =  month(date_range_start)) %>%
#   dplyr::select(-date_range_start) %>%
#   mutate(popularity_by_day = future_map(popularity_by_day, function(x){
#     jsonlite::fromJSON(x) %>%
#       as_tibble() %>%
#       gather()
#   }))%>%
#   unnest(popularity_by_day) %>%
#   rename(visitWeekday =key ,visits= value)
#
# st_write(visitWeekday,"data/output/visitWeekday.GeoJSON")
visitWeekday <- st_read("data/output/visitWeekday.GeoJSON")
visitCount %>%group_by(placekey) %>% mutate(visits=sum(visits))
visitCount <- visitCount %>%
rename(visitDay = date_range_start) %>%
mutate(visitDay = day+visitDay-1) %>%
mutate(month = month(visitDay))
visitCount %>%group_by(placekey) %>% mutate(visits=sum(visits))
visitCount %>%dplyr::select(-visitDay) %>% group_by(placekey) %>% mutate(visits=sum(visits))
visitCount %>%dplyr::select(-visitDay,-day) %>% group_by(placekey) %>% mutate(visits=sum(visits))
visitCount %>%dplyr::select(-visitDay,-day,-month) %>% group_by(placekey) %>% mutate(visits=sum(visits))
test <- visitCount %>%dplyr::select(-visitDay,-day,-month) %>% group_by(placekey) %>% mutate(visits=sum(visits))
View(test)
test <- visitCount %>%dplyr::select(-visitDay,-day,-month) %>% group_by(placekey) %>% mutate(visits=sum(visits)) %>% distinct()
test <- visitCount %>%dplyr::select(-visitDay,-day,-month) %>% group_by(placekey) %>%summarise() %>%  mutate(visits=sum(visits))
test <- visitCount %>%dplyr::select(-visitDay,-day,-month) %>% group_by(placekey) %>%summarise(visits=sum(visits))
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = visits),alpha = 0.5)
sumVisit <- visitCount %>%dplyr::select(-visitDay,-day,-month) %>% group_by(placekey) %>%summarise(visits=sum(visits))
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = visits),alpha = 0.5)
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = visits),alpha = 0.5) %>% mapTheme()
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = visits),alpha = 0.5) +mapTheme()
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = q5(visits)),alpha = 0.5) +mapTheme()
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = qBr(visits)),alpha = 0.5) +mapTheme()
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = q5(visits)),alpha = 0.5) +mapTheme()
ggplot(sumVisit)+
geom_sf(aes(color = palette1_main,fill = palette1_main, size = visits),alpha = 0.5) +mapTheme()
ggplot(sumVisit)+
geom_sf(
aes(size = visits),
color = palette1_main,
fill = palette1_main,
alpha = 0.5) +
mapTheme()
ggplot(sumVisit)+
geom_sf(
aes(size = visits),
color = palette1_main,
fill = palette1_main,
alpha = 0.2) +
mapTheme()
ggplot(sumVisit)+
geom_sf(
aes(size = visits),
color = palette1_main,
fill = palette1_main,
alpha = 0.3) +
mapTheme()
library(rgdal)
pprServiceArea <- read_sf(dsn="data/FromPPR/PPR_Service_Areas_2021/PPR_Service_Areas_2021.shp")%>%
st_transform(crs = crs)
pprDestServiceArea <- pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9))
ggplot() +
geom_sf(data=pprServiceArea,color='black',size=1,fill = "transparent")+
geom_sf(data=pprDestServiceArea,color=palette1_main,size=2,fill = "transparent")+
geom_sf(data=st_union(pprDistrict),color="black",size=2,fill = "transparent")+
labs(title = "",
subtitle = "",
x="",y="")+
mapTheme()
ggplot(sumVisit)+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
geom_sf(data=pprServiceArea,color='black',size=1)+
mapTheme()
ggplot(sumVisit)+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
geom_sf(data=pprServiceArea,color='black',size=0.5,fill='transparant')+
mapTheme()
ggplot(sumVisit)+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
geom_sf(data=pprServiceArea,color='black',size=0.5,fill=transparant)+
mapTheme()
ggplot(sumVisit)+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
geom_sf(data=pprServiceArea,color='black',size=0.5,fill=fill = "transparent")+
ggplot(sumVisit)+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
geom_sf(data=pprServiceArea,color='black',size=0.5,fill= "transparent")+
mapTheme()
View(pprServiceArea)
ggplot(sumVisit)+
geom_sf(data=pprServiceArea,color='black',size=0.25,fill= "transparent")+
geom_sf(data=pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9)),color='black',size=0.5,fill= "transparent")+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
mapTheme()
visitCount %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
st_drop_geometry()%>%
na.omit()%>%
ggplot(aes(visitDay,visits)) +
geom_line(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Date",y="Safegraph Visit")+
plotTheme(10,20)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
View(visitCount)
#st_write(PPRmoves,"data/output/PPRmoves.GeoJSON")
PPRmoves <- st_read("data/output/PPRmoves.GeoJSON")
View(PPRmoves)
sumVisit <- visitCount %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-visitDay,-day) %>%
group_by(month) %>%
summarise(visits=sum(visits))
View(sumVisit)
ggplot(data=sumVisit,aes(month,visits)) +
geom_histogram(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")+
plotTheme(10,20)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data=sumVisit,aes(visits)) +
geom_histogram(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")+
plotTheme(10,20)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data=sumVisit,aes(month)) +
geom_histogram(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")+
plotTheme(10,20)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
sumVisit <- visitCount %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-visitDay,-day) %>%
group_by(month) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
ggplot(data=sumVisit,aes(visits)) +
geom_histogram(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")+
plotTheme(10,20)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
hist(sumVisit)
hist(sumVisit$month,sumVisit$visits)
ggplot(data=sumVisit,aes(x=month)) +
geom_histogram(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")+
plotTheme(10,20)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data=sumVisit,aes(x=month)) +
geom_histogram(color=palette1_main,size=1)+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")
ggplot(data=sumVisit,aes(x=month)) +
geom_histogram()+
labs(title = 'Zeihler Playground',x="Visit Month",y="Safegraph Visit")
sumVisit %>%
ggplot(aes(x=month)) +
geom_histogram()
sumVisit <- visitCount %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-visitDay,-day) %>%
group_by(month) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
View(sumVisit)
sumVisit %>%
ggplot(aes(month,visits)) +
geom_bar()
sumVisit %>%
ggplot(aes(month)) +
geom_bar()
library(ggplot2)
sumVisit %>%
ggplot(aes(month)) +
geom_bar()
?geom_bar
sumVisit %>%
ggplot(aes(month,visits)) +
geom_bar()
sumVisit %>%
ggplot(aes(x=month,y=visits)) +
geom_bar()
sumVisit%>%
ggplot(aes(month,visits)) +
geom_bar(position ="dodge",fill = palette1_main) +
labs(x="Direction", y="Mean",
title ="",
subtitle = "") +
plotTheme() +
theme(legend.position = "none")
sumVisit%>%
ggplot(aes(month,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Direction", y="Mean",
title ="",
subtitle = "") +
plotTheme() +
theme(legend.position = "none")
sumVisit%>%
ggplot(aes(month,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Month", y="Aggregated Visits",
title ='Zeihler Playground') +
plotTheme(10,20)
visitHour <-
PPRmoves %>%
select(placekey, popularity_by_hour, date_range_start) %>%
mutate(date_range_start = as_date(date_range_start),
month =  month(date_range_start)) %>%
dplyr::select(-date_range_start) %>%
mutate(popularity_by_hour = future_map(popularity_by_hour, function(x){
unlist(x) %>%
as_tibble() %>%
rowid_to_column(var = "hour") %>%
rename(visit = value)
}))%>%
unnest(popularity_by_hour)
#
st_write(visitHour,"data/output/visitHour.GeoJSON")
#
st_write(visitHour,"data/output/visitHour.GeoJSON")
sumVisit <- visitHour %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-visitDay,-month) %>%
group_by(hour) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit <- visitHour %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(hour) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit <- visitHour %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(hour) %>%
summarise(visits=sum(visit)) %>%
st_drop_geometry()
sumVisit%>%
ggplot(aes(hour,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="hour", y="Aggregated Visits",
title ='Zeihler Playground') +
plotTheme(10,20)
sumVisit <- visitHour %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visitWeekday)) %>%
st_drop_geometry()
sumVisit <- visitHour %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit <- visitHour %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit <- visitWeekday %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit%>%
ggplot(aes(visitWeekday,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Weekday", y="Aggregated Visits",
title ='Zeihler Playground') +
plotTheme(10,20)
View(sumVisit)
sumVisit <- visitWeekday %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry() %>%
as_date(visitWeekday)
sumVisit <- visitWeekday %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit%>%
ggplot(aes(visitWeekday,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Weekday", y="Aggregated Visits",
title ='Zeihler Playground') +
plotTheme(10,20)
sumVisit <- visitWeekday %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(visitWeekday) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit$visitWeekday <- factor(sumVisit$visitWeekday, levels= c("Monday",
"Tuesday", "Wednesday", "Thursday", "Friday", "Saturday","Sunday"))
sumVisit[order(sumVisit$visitWeekday), ]
sumVisit%>%
ggplot(aes(visitWeekday,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Weekday", y="Aggregated Visits",
title ='Zeihler Playground') +
plotTheme(10,20)
View(originCount)
sumVisit <- originCount %>%
dplyr::select(-month) %>%
group_by(placekey,origin) %>%
summarise(visits=sum(visits))
View(dwellTime)
sumVisit <- dwellTime %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(dwellTime) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit <- dwellTime %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(dwellTimes) %>%
summarise(visits=sum(visits)) %>%
st_drop_geometry()
sumVisit <- dwellTime %>%
filter(placekey=='zzz-222@628-pj6-ndv') %>%
dplyr::select(-month) %>%
group_by(dwellTimes) %>%
summarise(visitors=sum(visitors)) %>%
st_drop_geometry()
View(sumVisit)
sumVisit$dwellTimes
sumVisit$dwellTimes <- factor(sumVisit$dwellTimes, levels= c("<5",">240","11-20","121-240","21-60","5-10","61-120" ))
sumVisit[order(sumVisit$dwellTimes), ]
sumVisit%>%
ggplot(aes(visitWeekday,visits)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Weekday", y="Aggregated Visits",
title ='Zeihler Playground') +
plotTheme(10,20)
sumVisit%>%
ggplot(aes(dwellTimes,visitors)) +
geom_bar(position ="dodge",fill = palette1_main,stat='identity') +
labs(x="Dwell Time", y="Aggregated Visitors",
title ='Zeihler Playground') +
plotTheme(10,20)
sumVisit <- originCount %>%
dplyr::select(-month) %>%
group_by(placekey,origin) %>%
summarise(visits=sum(visits))
sumVisit <- originCount %>%
dplyr::select(-placekey,-month) %>%
group_by(origin) %>%
summarise(visits=sum(visits))
ggplot(sumVisit)+
geom_sf(data=pprServiceArea,color='black',size=0.25,fill= "transparent")+
geom_sf(data=pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9)),color='black',size=0.5,fill= "transparent")+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
mapTheme()
sumVisit %>% sumVisit %>% na.omit()
sumVisit %>% na.omit()
sumVisit2 <- sumVisit %>% na.omit()
ggplot(sumVisit2)+
geom_sf(data=pprServiceArea,color='black',size=0.25,fill= "transparent")+
geom_sf(data=pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9)),color='black',size=0.5,fill= "transparent")+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
mapTheme()
View(sumVisit2)
sumVisit %>% filter(geometry=='
c(NA, NA)')
sumVisit %>% filter(geometry=='c(NA, NA)')
sumVisit %>% filter(geometry='c(NA, NA)')
sumVisit %>% filter(geometry=='c(NA, NA)')
sumVisit %>% filter(st_is_empty())
sumVisit %>% filter(st_is_empty(.))
sumVisit2 <- sumVisit %>% filter(!st_is_empty(.))
ggplot(sumVisit2)+
geom_sf(data=pprServiceArea,color='black',size=0.25,fill= "transparent")+
geom_sf(data=pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9)),color='black',size=0.5,fill= "transparent")+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
mapTheme()
sumVisit <- originCount %>%
dplyr::select(-placekey,-month) %>%
group_by(origin) %>%
summarise(visits=sum(visits),geometry=first(geometry))
dplyr::select(-placekey,-month) %>%
group_by(origin) %>%
summarise(visits=sum(visits),geometry=first(geometry))
sumVisit <- originCount %>%
filter(!st_is_empty(.)) %>%
dplyr::select(-placekey,-month) %>%
group_by(origin) %>%
summarise(visits=sum(visits),geometry=first(geometry))
sumVisit <- originCount %>%
filter(!st_is_empty(.)) %>%
dplyr::select(-placekey,-month) %>%
group_by(origin) %>%
summarise(visits=sum(visits))
sumVisit <- originCount %>%
filter(!st_is_empty(.))
sumVisit <- originCount %>%
filter(!st_is_empty(.)) %>%
dplyr::select(-placekey,-month) %>%
group_by(origin) %>%
summarise(visits=sum(visits))
ggplot(sumVisit2)+
geom_sf(data=pprServiceArea,color='black',size=0.25,fill= "transparent")+
geom_sf(data=pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9)),color='black',size=0.5,fill= "transparent")+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
mapTheme()
ggplot(sumVisit)+
geom_sf(data=pprServiceArea,color='black',size=0.25,fill= "transparent")+
geom_sf(data=pprServiceArea %>% filter(PPR_DIST %in% c(7,8,9)),color='black',size=0.5,fill= "transparent")+
geom_sf(aes(size = visits),color = palette1_main,fill = palette1_main,alpha = 0.3) +
mapTheme()
